<div class="app-container">
  <header class="app-header">
    <h1>⚔️ LoL Matchmaking</h1>
    <div class="status-indicators">
      <span class="status" [class.connected]="isConnected" [class.disconnected]="!isConnected">
        🔗 {{ isConnected ? 'Conectado' : 'Desconectado' }}
      </span>
      <span class="status" [class.connected]="lcuStatus.isConnected" [class.disconnected]="!lcuStatus.isConnected">
        🎮 {{ lcuStatus.isConnected ? 'LoL Cliente' : 'LoL Offline' }}
      </span>
    </div>
  </header>
  <!-- Navigation -->
  <nav class="nav-buttons">
    <button
      [class.active]="currentView === 'dashboard'"
      (click)="setCurrentView('dashboard')">
      🏠 Dashboard
    </button>
    <button
      [class.active]="currentView === 'queue'"
      (click)="setCurrentView('queue')">
      ⏱️ Fila ({{ queueStatus.playersInQueue }})
    </button>
    <button
      [class.active]="currentView === 'p2p'"
      (click)="setCurrentView('p2p')">
      🔗 Rede P2P
    </button>
    <button
      [class.active]="currentView === 'history'"
      (click)="setCurrentView('history')">
      📊 Histórico
    </button>
    <button
      [class.active]="currentView === 'settings'"
      (click)="setCurrentView('settings')">
      ⚙️ Configurações
    </button>
  </nav>
  <!-- Content -->
  <main class="content">    <!-- Draft Phase -->
    <div *ngIf="inDraftPhase" class="view-container draft-view">
      <!-- Draft Preview Phase -->
      <div *ngIf="draftPhase === 'preview'" class="draft-preview">
        <h2>🎯 Partida Encontrada!</h2>
        <div class="draft-info">
          <p>Todos os jogadores aceitaram! Prepare-se para a fase de pick & ban.</p>
          <div *ngIf="draftData" class="match-details">
            <h3>Detalhes da Partida:</h3>
            <p><strong>ID da Partida:</strong> {{ draftData.matchId }}</p>
            <div class="teams">
              <div class="team blue-team">
                <h4>🔵 Time Azul</h4>
                <ul>
                  <li *ngFor="let player of draftData.blueTeam"
                      [class.current-player]="player.summonerName === currentPlayer?.summonerName">
                    {{ player.summonerName }}
                    <span *ngIf="player.summonerName === currentPlayer?.summonerName" class="you-indicator">(Você)</span>
                  </li>
                </ul>
              </div>
              <div class="team red-team">
                <h4>🔴 Time Vermelho</h4>
                <ul>
                  <li *ngFor="let player of draftData.redTeam"
                      [class.current-player]="player.summonerName === currentPlayer?.summonerName">
                    {{ player.summonerName }}
                    <span *ngIf="player.summonerName === currentPlayer?.summonerName" class="you-indicator">(Você)</span>
                  </li>
                </ul>
              </div>            </div>
          </div>

          <!-- Leadership Management -->
          <div *ngIf="isMatchLeader" class="leadership-panel">
            <h4>👑 Gerenciar Liderança</h4>
            <p>Como líder, você pode transferir a liderança para outro jogador:</p>
            <div class="transfer-options">
              <div *ngFor="let player of getEligibleLeaders()" class="transfer-option">
                <span class="player-name">{{ player.summonerName }}</span>
                <button (click)="transferLeadership(player)" class="btn-transfer">
                  👑 Tornar Líder
                </button>
              </div>
              <div *ngIf="getEligibleLeaders().length === 0" class="no-options">
                <p>Nenhum outro jogador humano disponível para liderança.</p>
              </div>
            </div>
          </div>

          <div *ngIf="!isMatchLeader" class="leadership-info">
            <p>👑 Você não é o líder desta partida.</p>
          </div>
            <div class="draft-actions">
            <button (click)="startPickBan()" class="btn-primary">⚔️ Ir para os Picks</button>
            <button (click)="exitDraft()" class="btn-secondary">❌ Cancelar</button>
          </div>
        </div>
      </div>      <!-- Pick & Ban Phase -->
      <div *ngIf="draftPhase === 'pickban'" class="draft-pickban">
        <div class="draft-header">
          <h2>🎯 Pick & Ban Phase</h2>
          <div class="draft-timer">
            <span class="timer-label">Tempo restante:</span>
            <span class="timer-value">{{ draftTimer }}s</span>
          </div>
          <div class="current-action">
            <span>{{ getCurrentActionText() }}</span>
          </div>
        </div>

        <div class="draft-content">
          <!-- Teams Display -->
          <div class="teams-display">
            <div class="team blue-side">
              <h3>🔵 Time Azul</h3>
              <div class="bans-section">
                <h4>Bans:</h4>
                <div class="ban-slots">
                  <div *ngFor="let ban of getBansForTeam('blue'); let i = index"
                       class="ban-slot" [class.filled]="ban">
                    <div *ngIf="ban" class="champion-ban">{{ ban.name || 'Campeão' }}</div>
                    <div *ngIf="!ban" class="empty-slot">Ban {{ i + 1 }}</div>
                  </div>
                </div>
              </div>
              <div class="picks-section">
                <h4>Picks:</h4>
                <div class="pick-slots">
                  <div *ngFor="let player of draftData.blueTeam; let i = index"
                       class="pick-slot" [class.current]="isCurrentPicker(player, 'blue')">
                    <div class="player-info">
                      <span class="player-name">{{ player.summonerName }}</span>
                      <div class="champion-pick" [class.picked]="player.champion">
                        {{ player.champion?.name || 'Aguardando...' }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="team red-side">
              <h3>🔴 Time Vermelho</h3>
              <div class="bans-section">
                <h4>Bans:</h4>
                <div class="ban-slots">
                  <div *ngFor="let ban of getBansForTeam('red'); let i = index"
                       class="ban-slot" [class.filled]="ban">
                    <div *ngIf="ban" class="champion-ban">{{ ban.name || 'Campeão' }}</div>
                    <div *ngIf="!ban" class="empty-slot">Ban {{ i + 1 }}</div>
                  </div>
                </div>
              </div>
              <div class="picks-section">
                <h4>Picks:</h4>
                <div class="pick-slots">
                  <div *ngFor="let player of draftData.redTeam; let i = index"
                       class="pick-slot" [class.current]="isCurrentPicker(player, 'red')">
                    <div class="player-info">
                      <span class="player-name">{{ player.summonerName }}</span>
                      <div class="champion-pick" [class.picked]="player.champion">
                        {{ player.champion?.name || 'Aguardando...' }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Champion Selection (only for current player if it's their turn) -->
          <div *ngIf="isMyTurn()" class="champion-selection">
            <h3>{{ isCurrentlyBanning() ? '🚫 Escolha um campeão para banir' : '⚔️ Escolha seu campeão' }}</h3>
            <div class="champion-grid">
              <div *ngFor="let champion of getAvailableChampions()"
                   class="champion-card"
                   [class.selected]="selectedChampion?.id === champion.id"
                   (click)="selectChampion(champion)">
                <img [src]="champion.imageUrl" [alt]="champion.name" class="champion-image">
                <span class="champion-name">{{ champion.name }}</span>
              </div>
            </div>
            <div class="selection-actions">
              <button [disabled]="!selectedChampion"
                      (click)="confirmSelection()"
                      class="btn-primary">
                {{ isCurrentlyBanning() ? '🚫 Banir Campeão' : '⚔️ Confirmar Pick' }}
              </button>
            </div>
          </div>

          <!-- Other players turn display -->
          <div *ngIf="!isMyTurn()" class="waiting-display">
            <h3>⏱️ Aguardando...</h3>
            <p>{{ getCurrentActionText() }}</p>
          </div>
        </div>

        <div class="draft-actions">
          <button (click)="onPickBanCancel()" class="btn-secondary">❌ Cancelar Draft</button>
        </div>
      </div>
    </div>

    <!-- Normal Views -->
    <ng-container *ngIf="!inDraftPhase" [ngSwitch]="currentView">
      <!-- Dashboard -->
      <div *ngSwitchCase="'dashboard'" class="view-container">
        <app-dashboard
          [player]="currentPlayer"
          [queueStatus]="queueStatus"
          (joinQueue)="setCurrentView('queue')"
          (viewHistory)="setCurrentView('history')"
          (openSettings)="setCurrentView('settings')">
        </app-dashboard>
      </div><!-- Queue -->
      <div *ngSwitchCase="'queue'" class="view-container">        <app-queue
          [isInQueue]="isInQueue"
          [queueStatus]="queueStatus"
          [currentPlayer]="currentPlayer"
          (joinQueue)="joinQueue($event)"
          (leaveQueue)="leaveQueue()"
          (addBot)="addBotToQueue()">
        </app-queue>
      </div>

      <!-- P2P Network -->
      <div *ngSwitchCase="'p2p'" class="view-container">
        <h2>🔗 Rede Peer-to-Peer</h2>
        <p>Sistema de conexão direta entre jogadores para matchmaking descentralizado.</p>
        <app-p2p-status></app-p2p-status>
      </div><!-- History -->
      <div *ngSwitchCase="'history'" class="view-container">
        <app-match-history [player]="currentPlayer"></app-match-history>
      </div>

      <!-- Settings -->
      <div *ngSwitchCase="'settings'" class="view-container">
        <h2>⚙️ Configurações</h2>

        <div class="auto-detect-section">
          <h3>🤖 Detecção Automática</h3>
          <p>O aplicativo pode detectar automaticamente suas informações do League of Legends:</p>

          <button
            type="button"
            (click)="refreshLCUConnection()"
            class="btn-primary"
            [disabled]="!isConnected">
            🔄 Detectar do LoL Cliente
          </button>

          <div class="lcu-status" *ngIf="lcuStatus.isConnected">
            <p>✅ Cliente do LoL conectado</p>
            <p *ngIf="currentPlayer">
              Jogador detectado: <strong>{{ currentPlayer.summonerName }}</strong>
            </p>
          </div>
        </div>

        <div class="manual-config-section" *ngIf="!currentPlayer">
          <h3>📝 Configuração Manual</h3>
          <p>Se a detecção automática não funcionar, configure manualmente:</p>

          <form class="settings-form">
            <div class="form-group">
              <label for="summonerName">Nome do Invocador:</label>
              <input
                id="summonerName"
                type="text"
                [(ngModel)]="settingsForm.summonerName"
                placeholder="Seu nome no LoL"
                name="summonerName">
            </div>

            <div class="form-group">
              <label for="region">Região:</label>
              <select id="region" [(ngModel)]="settingsForm.region" name="region">
                <option value="br1">Brasil</option>
                <option value="na1">América do Norte</option>
                <option value="euw1">Europa Oeste</option>
                <option value="eun1">Europa Nordeste</option>
              </select>
            </div>

            <button type="button" (click)="savePlayerSettings()" class="btn-primary">
              💾 Salvar Configurações
            </button>
          </form>
        </div>

        <div class="current-config" *ngIf="currentPlayer">
          <h3>👤 Configuração Atual</h3>
          <div class="player-summary">            <img [src]="'https://ddragon.leagueoflegends.com/cdn/15.12.1/img/profileicon/' + (currentPlayer.profileIconId || 29) + '.png'"
                 alt="Profile Icon"
                 class="profile-icon-small"
                 (error)="onProfileIconError($event)">
            <div class="player-info">
              <h4>{{ currentPlayer.summonerName }}{{ currentPlayer.tagLine ? '#' + currentPlayer.tagLine : '' }}</h4>
              <p>Nível {{ currentPlayer.summonerLevel || 'N/A' }} • Região: {{ currentPlayer.region }}</p>
              <p>MMR: {{ currentPlayer.currentMMR }}</p>
              <p *ngIf="currentPlayer.rank" class="ranked-info">
                Ranqueada: {{ currentPlayer.rank.tier }} {{ currentPlayer.rank.rank }}
                ({{ currentPlayer.rank.lp }} LP)
              </p>
            </div>
          </div>

          <div class="action-buttons">
            <button type="button" (click)="refreshPlayerData()" class="btn-primary">
              🔄 Atualizar Dados
            </button>
            <button type="button" (click)="clearPlayerData()" class="btn-secondary">
              🗑️ Limpar Dados
            </button>
          </div>
        </div>

        <!-- Riot API Key Configuration -->
        <div class="riot-api-config">
          <h3>🔑 Configuração da Riot API</h3>
          <p>Para acessar dados completos do Riot Games, configure sua API key:</p>

          <div class="form-group">
            <label for="riotApiKey">Riot API Key:</label>
            <input type="password"
                   id="riotApiKey"
                   [(ngModel)]="settingsForm.riotApiKey"
                   name="riotApiKey"
                   placeholder="RGAPI-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
            <small>Obtenha sua API key em: <a href="https://developer.riotgames.com" target="_blank">developer.riotgames.com</a></small>
          </div>

          <button type="button" (click)="updateRiotApiKey()" class="btn-primary">
            🔑 Configurar API Key
          </button>        </div>
      </div>

    </ng-container>
  </main>

  <!-- Match Found Modal -->
  <app-match-found
    [matchData]="matchFoundData"
    [isVisible]="showMatchFound"
    (acceptMatch)="onAcceptMatch($event)"
    (declineMatch)="onDeclineMatch($event)">
  </app-match-found>

  <!-- Notifications -->
  <div class="notifications">
    <div
      *ngFor="let notification of notifications; trackBy: trackNotification"
      class="notification"
      [class]="'notification-' + notification.type">
      <div class="notification-content">
        <strong>{{ notification.title }}</strong>
        <p>{{ notification.message }}</p>
      </div>
      <button (click)="dismissNotification(notification.id)" class="notification-close">✕</button>
    </div>
  </div>
</div>
