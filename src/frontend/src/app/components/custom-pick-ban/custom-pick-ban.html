<div class="custom-pick-ban" *ngIf="session">
  <!-- Header -->
  <div class="pick-ban-header">
    <div class="session-info">
      <h2>üèÜ Sele√ß√£o de Campe√µes</h2>
      <div class="phase-indicator">
        <span class="current-phase">{{ getCurrentPhaseText() }}</span>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getPhaseProgress()"></div>
        </div>
      </div>
    </div>    <div class="timer-section">
      <div class="timer" [class.warning]="timeRemaining <= 10">
        ‚è±Ô∏è {{ timeRemaining }}s
      </div>

      <!-- Current Player Indicator -->
      <div class="current-player" *ngIf="session">
        <span class="current-player-text">
          {{ getCurrentPlayerName() }}
        </span>
      </div>
    </div>
  </div>

  <!-- Teams Display -->
  <div class="teams-container">
    <!-- Blue Team -->
    <div class="team blue-team">
      <div class="team-header">
        <span class="team-name">üîµ Time Azul</span>
      </div>

      <!-- Bans do Time Azul -->
      <div class="team-bans">
        <h4>üö´ Bans do Time Azul</h4>
        <div class="banned-champions-row">
          <div class="banned-champion"
               *ngFor="let ban of getTeamBans('blue')">
            <img [src]="ban.image" [alt]="ban.name" class="banned-img">
            <span class="banned-name">{{ ban.name }}</span>
          </div>
          <div class="banned-placeholder" *ngFor="let i of [1,2,3,4,5].slice(getTeamBans('blue').length)">
            <div class="ban-placeholder">?</div>
            <span class="banned-name">Aguardando...</span>
          </div>
        </div>
      </div>

      <div class="team-picks">
        <div class="pick-slot"
             *ngFor="let pick of getTeamPicks('blue'); let i = index">
          <img [src]="pick.image" [alt]="pick.name" class="champion-img">
          <div class="pick-info">
            <span class="champion-name">{{ pick.name }}</span>
            <span class="player-name">
              {{ getPlayerNameForPick('blue', i) }}
              <span class="you-indicator" *ngIf="isCurrentPlayerForPick('blue', i)">(Voc√™)</span>
            </span>
            <span class="player-lane">{{ getPlayerLaneDisplay('blue', i) }}</span>
          </div>
        </div>

        <!-- Empty slots ordenados por lane -->
        <div class="pick-slot empty"
             *ngFor="let player of getSortedTeamByLane('blue').slice(getTeamPicks('blue').length); let i = index">
          <div class="champion-placeholder">?</div>
          <div class="pick-info">
            <span class="champion-name">Aguardando...</span>
            <span class="player-name">
              {{ player.summonerName || player.name || 'Jogador' }}
              <span class="you-indicator" *ngIf="isCurrentPlayer(player)">(Voc√™)</span>
            </span>
            <span class="player-lane">{{ getPlayerLaneDisplayForPlayer(player) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Center - Bans Gerais -->
    <div class="bans-section">
      <h3>üö´ Banidos</h3>
      <div class="banned-champions">
        <div class="banned-champion"
             *ngFor="let ban of getBannedChampions()">
          <img [src]="ban.image" [alt]="ban.name" class="banned-img">
          <span class="banned-name">{{ ban.name }}</span>
        </div>
      </div>
    </div>

    <!-- Red Team -->
    <div class="team red-team">
      <div class="team-header">
        <span class="team-name">üî¥ Time Vermelho</span>
      </div>

      <!-- Bans do Time Vermelho -->
      <div class="team-bans">
        <h4>üö´ Bans do Time Vermelho</h4>
        <div class="banned-champions-row">
          <div class="banned-champion"
               *ngFor="let ban of getTeamBans('red')">
            <img [src]="ban.image" [alt]="ban.name" class="banned-img">
            <span class="banned-name">{{ ban.name }}</span>
          </div>
          <div class="banned-placeholder" *ngFor="let i of [1,2,3,4,5].slice(getTeamBans('red').length)">
            <div class="ban-placeholder">?</div>
            <span class="banned-name">Aguardando...</span>
          </div>
        </div>
      </div>

      <div class="team-picks">
        <div class="pick-slot"
             *ngFor="let pick of getTeamPicks('red'); let i = index">
          <img [src]="pick.image" [alt]="pick.name" class="champion-img">
          <div class="pick-info">
            <span class="champion-name">{{ pick.name }}</span>
            <span class="player-name">
              {{ getPlayerNameForPick('red', i) }}
              <span class="you-indicator" *ngIf="isCurrentPlayerForPick('red', i)">(Voc√™)</span>
            </span>
            <span class="player-lane">{{ getPlayerLaneDisplay('red', i) }}</span>
          </div>
        </div>

        <!-- Empty slots ordenados por lane -->
        <div class="pick-slot empty"
             *ngFor="let player of getSortedTeamByLane('red').slice(getTeamPicks('red').length); let i = index">
          <div class="champion-placeholder">?</div>
          <div class="pick-info">
            <span class="champion-name">Aguardando...</span>
            <span class="player-name">
              {{ player.summonerName || player.name || 'Jogador' }}
              <span class="you-indicator" *ngIf="isCurrentPlayer(player)">(Voc√™)</span>
            </span>
            <span class="player-lane">{{ getPlayerLaneDisplayForPlayer(player) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Champion Selection -->
  <div class="champion-selection" *ngIf="isMyTurn">
    <div class="selection-header">
      <h3>
        {{ session.phases[session.currentAction] && session.phases[session.currentAction].action === 'ban' ? 'üö´ Banir Campe√£o' : '‚≠ê Escolher Campe√£o' }}
      </h3>
      <p class="selection-subtitle">
        Sua vez de {{ session.phases[session.currentAction] && session.phases[session.currentAction].action === 'ban' ? 'banir' : 'escolher' }} um campe√£o
      </p>
    </div>

    <!-- Bot√£o para abrir modal -->
    <div class="modal-trigger-section">
      <button class="btn btn-primary btn-lg open-modal-btn" (click)="openChampionModal()">
        <span class="btn-icon">{{ getCurrentActionIcon() }}</span>
        <span class="btn-text">{{ getCurrentActionText() }}</span>
        <span class="btn-hint">Clique para abrir sele√ß√£o</span>
      </button>
    </div>
  </div>

  <!-- Waiting Message -->
  <div class="waiting-message" *ngIf="!isMyTurn && session.phase !== 'completed'">
    <div class="waiting-content">
      <div class="waiting-icon">‚è≥</div>
      <h3>Aguardando outros jogadores...</h3>
      <p>{{ getCurrentPhaseText() }}</p>
    </div>
  </div>

  <!-- Completion Message -->
  <div class="completion-message" *ngIf="session.phase === 'completed'">
    <div class="completion-content">
      <div class="completion-icon">‚úÖ</div>
      <h3>Sele√ß√£o de Campe√µes Completa!</h3>
      <p>A partida pode come√ßar agora.</p>

      <div class="final-teams">
        <div class="final-team">
          <h4>üîµ Time Azul</h4>
          <div class="final-picks">
            <div class="final-pick" *ngFor="let pick of getTeamPicks('blue')">
              <img [src]="pick.image" [alt]="pick.name" class="final-champion-img">
              <span class="final-champion-name">{{ pick.name }}</span>
            </div>
          </div>
        </div>

        <div class="final-team">
          <h4>üî¥ Time Vermelho</h4>
          <div class="final-picks">
            <div class="final-pick" *ngFor="let pick of getTeamPicks('red')">
              <img [src]="pick.image" [alt]="pick.name" class="final-champion-img">
              <span class="final-champion-name">{{ pick.name }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="completion-actions">
        <button class="btn btn-success btn-lg" (click)="completePickBan()">
          ‚úÖ Iniciar Partida
        </button>
        <button class="btn btn-secondary btn-lg" (click)="cancelPickBan()">
          ‚ùå Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- ========== MODAL DE SELE√á√ÉO DE CAMPE√ïES ========== -->
  <div class="champion-modal-overlay" *ngIf="showChampionModal" (click)="closeChampionModal()">
    <div class="champion-modal" (click)="$event.stopPropagation()">
      <!-- Header do Modal -->
      <div class="modal-header" [style.border-color]="getCurrentTeamColor()">
        <div class="modal-title">
          <span class="modal-icon">{{ getCurrentActionIcon() }}</span>
          <div class="modal-title-text">
            <h2>{{ getCurrentActionText() }}</h2>
            <p class="modal-subtitle">
              {{ getCurrentPlayerNameForModal() }} - {{ getCurrentPlayerTeamForModal() }}
              <span class="you-indicator" *ngIf="isCurrentPlayerForModal()">(Voc√™)</span>
            </p>
          </div>
        </div>
        
        <!-- Timer do Modal -->
        <div class="modal-timer-section">
          <div class="modal-timer" [class.warning]="modalTimeRemaining <= 10">
            ‚è±Ô∏è {{ modalTimeRemaining }}s
          </div>
        </div>
        
        <button class="modal-close-btn" (click)="closeChampionModal()">
          ‚úï
        </button>
      </div>

      <!-- Conte√∫do do Modal -->
      <div class="modal-content">
        <!-- Filtros -->
        <div class="modal-filters">
          <!-- Role Filter -->
          <div class="modal-role-filter">
            <div class="filter-label">Filtrar por Lane:</div>
            <div class="role-buttons">
              <button
                class="role-btn"
                [class.active]="modalSelectedRole === 'all'"
                (click)="selectRoleInModal('all')">
                Todos ({{ champions.length }})
              </button>
              <button
                class="role-btn"
                [class.active]="modalSelectedRole === 'top'"
                (click)="selectRoleInModal('top')">
                üõ°Ô∏è Top ({{ championsByRole.top?.length || 0 }})
              </button>
              <button
                class="role-btn"
                [class.active]="modalSelectedRole === 'jungle'"
                (click)="selectRoleInModal('jungle')">
                üå≤ Jungle ({{ championsByRole.jungle?.length || 0 }})
              </button>
              <button
                class="role-btn"
                [class.active]="modalSelectedRole === 'mid'"
                (click)="selectRoleInModal('mid')">
                ‚ö° Mid ({{ championsByRole.mid?.length || 0 }})
              </button>
              <button
                class="role-btn"
                [class.active]="modalSelectedRole === 'adc'"
                (click)="selectRoleInModal('adc')">
                üèπ ADC ({{ championsByRole.adc?.length || 0 }})
              </button>
              <button
                class="role-btn"
                [class.active]="modalSelectedRole === 'support'"
                (click)="selectRoleInModal('support')">
                üíé Support ({{ championsByRole.support?.length || 0 }})
              </button>
            </div>
          </div>

          <!-- Search -->
          <div class="modal-search-container">
            <div class="search-wrapper">
              <input
                id="modal-champion-search"
                type="text"
                [(ngModel)]="modalSearchFilter"
                placeholder="Buscar campe√£o pelo nome..."
                class="modal-champion-search"
                autocomplete="off">
              <span class="search-icon">üîç</span>
            </div>
            <span class="search-results-count">{{ getModalFilteredChampions().length }} campe√µes encontrados</span>
          </div>
        </div>

        <!-- Grid de Campe√µes -->
        <div class="modal-champions-grid">
          <div class="modal-champion-card"
               *ngFor="let champion of getModalFilteredChampions()"
               [class.selected]="modalSelectedChampion?.id === champion.id"
               [class.banned]="isChampionBanned(champion)"
               (click)="selectChampionInModal(champion)">
            <img
              [src]="champion.image"
              [alt]="champion.name"
              class="modal-champion-portrait"
              (error)="onImageError($event, champion)"
              loading="lazy">
            <span class="modal-champion-label">{{ champion.name }}</span>
            <div class="banned-overlay" *ngIf="isChampionBanned(champion)">
              <span class="banned-text">BANIDO</span>
            </div>
          </div>

          <!-- Estado vazio -->
          <div *ngIf="getModalFilteredChampions().length === 0" class="modal-no-champions">
            <div class="no-champions-icon">üòî</div>
            <div class="no-champions-text">Nenhum campe√£o encontrado</div>
            <div class="no-champions-hint">Tente ajustar os filtros ou busca</div>
          </div>
        </div>
      </div>

      <!-- Footer do Modal com Confirma√ß√£o -->
      <div class="modal-footer">
        <div class="modal-selection-preview" *ngIf="modalSelectedChampion">
          <div class="preview-content">
            <img [src]="modalSelectedChampion.image" [alt]="modalSelectedChampion.name" class="preview-img">
            <div class="preview-info">
              <span class="preview-name">{{ modalSelectedChampion.name }}</span>
              <span class="preview-action">
                {{ getCurrentActionText() }}
              </span>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn btn-secondary" (click)="cancelModalSelection()">
            ‚ùå Cancelar
          </button>
          <button 
            class="btn btn-primary confirm-btn" 
            [class.disabled]="!modalSelectedChampion || isChampionBanned(modalSelectedChampion)"
            [disabled]="!modalSelectedChampion || isChampionBanned(modalSelectedChampion)"
            (click)="confirmModalSelection()">
            {{ getCurrentActionIcon() }} Confirmar {{ getCurrentActionText() }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== DIALOGO DE CONFIRMA√á√ÉO FINAL ========== -->
  <div class="final-confirmation-overlay" *ngIf="showFinalConfirmation" (click)="cancelFinalDraft()">
    <div class="final-confirmation-modal" (click)="$event.stopPropagation()">
      <!-- Header -->
      <div class="confirmation-header">
        <div class="confirmation-icon">üéØ</div>
        <h2>Confirmar Sele√ß√£o Final</h2>
        <p>Verifique se todos os picks e bans est√£o corretos antes de continuar</p>
      </div>

      <!-- Conte√∫do -->
      <div class="confirmation-content">
        <!-- Times lado a lado, igual √† tela principal -->
        <div class="teams-container">
          <!-- Time Azul -->
          <div class="team blue-team">
            <div class="team-header">
              <span class="team-name">üîµ Time Azul</span>
            </div>

            <!-- Bans do Time Azul -->
            <div class="team-bans">
              <div class="ban-slot"
                   *ngFor="let ban of getTeamBans('blue'); let i = index">
                <img [src]="ban.image" [alt]="ban.name" class="ban-img">
                <span class="ban-name">{{ ban.name }}</span>
              </div>
              <!-- Slots vazios para completar 5 bans -->
              <div class="ban-slot empty-ban" *ngFor="let i of getEmptyBanSlots(getTeamBans('blue').length)">
                <div class="ban-placeholder">?</div>
                <span class="ban-name">Ban</span>
              </div>
            </div>

            <div class="team-picks">
              <div class="pick-slot"
                   *ngFor="let slot of finalConfirmationData?.blueTeamByLane; let i = index">
                <ng-container *ngIf="slot.champion">
                  <img [src]="slot.champion.image" [alt]="slot.champion.name" class="champion-img">
                  <div class="pick-info">
                    <span class="champion-name">{{ slot.champion.name }}</span>
                    <span class="player-name">
                      {{ slot.player?.summonerName || slot.player?.name || 'Jogador' }}
                      <span class="you-indicator" *ngIf="isCurrentPlayer(slot.player)">(Voc√™)</span>
                    </span>
                    <span class="player-lane">{{ getLaneDisplayName(slot.lane) }}</span>
                  </div>
                </ng-container>
                <ng-container *ngIf="!slot.champion">
                  <div class="champion-placeholder">?</div>
                  <div class="pick-info">
                    <span class="champion-name">Sem pick</span>
                    <span class="player-name">
                      {{ slot.player?.summonerName || slot.player?.name || 'Jogador' }}
                      <span class="you-indicator" *ngIf="isCurrentPlayer(slot.player)">(Voc√™)</span>
                    </span>
                    <span class="player-lane">{{ getLaneDisplayName(slot.lane) }}</span>
                  </div>
                </ng-container>
                <div class="edit-btn-cell">
                  <button 
                    class="edit-pick-btn" 
                    *ngIf="isCurrentPlayer(slot.player) || isPlayerBot(slot.player)"
                    (click)="isPlayerBot(slot.player) ? confirmBotPick(slot.player?.id || slot.player?.summonerName, slot.champion?.phaseIndex) : startEditingPick(slot.player?.id || slot.player?.summonerName, slot.champion?.phaseIndex)">
                    {{ isPlayerBot(slot.player) ? 'ü§ñ Confirmar Bot' : '‚úèÔ∏è Editar' }}
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Time Vermelho -->
          <div class="team red-team">
            <div class="team-header">
              <span class="team-name">üî¥ Time Vermelho</span>
            </div>

            <!-- Bans do Time Vermelho -->
            <div class="team-bans">
              <div class="ban-slot"
                   *ngFor="let ban of getTeamBans('red'); let i = index">
                <img [src]="ban.image" [alt]="ban.name" class="ban-img">
                <span class="ban-name">{{ ban.name }}</span>
              </div>
              <!-- Slots vazios para completar 5 bans -->
              <div class="ban-slot empty-ban" *ngFor="let i of getEmptyBanSlots(getTeamBans('red').length)">
                <div class="ban-placeholder">?</div>
                <span class="ban-name">Ban</span>
              </div>
            </div>

            <div class="team-picks">
              <div class="pick-slot"
                   *ngFor="let slot of finalConfirmationData?.redTeamByLane; let i = index">
                <ng-container *ngIf="slot.champion">
                  <img [src]="slot.champion.image" [alt]="slot.champion.name" class="champion-img">
                  <div class="pick-info">
                    <span class="champion-name">{{ slot.champion.name }}</span>
                    <span class="player-name">
                      {{ slot.player?.summonerName || slot.player?.name || 'Jogador' }}
                      <span class="you-indicator" *ngIf="isCurrentPlayer(slot.player)">(Voc√™)</span>
                    </span>
                    <span class="player-lane">{{ getLaneDisplayName(slot.lane) }}</span>
                  </div>
                </ng-container>
                <ng-container *ngIf="!slot.champion">
                  <div class="champion-placeholder">?</div>
                  <div class="pick-info">
                    <span class="champion-name">Sem pick</span>
                    <span class="player-name">
                      {{ slot.player?.summonerName || slot.player?.name || 'Jogador' }}
                      <span class="you-indicator" *ngIf="isCurrentPlayer(slot.player)">(Voc√™)</span>
                    </span>
                    <span class="player-lane">{{ getLaneDisplayName(slot.lane) }}</span>
                  </div>
                </ng-container>
                <div class="edit-btn-cell">
                  <button 
                    class="edit-pick-btn" 
                    *ngIf="isCurrentPlayer(slot.player) || isPlayerBot(slot.player)"
                    (click)="isPlayerBot(slot.player) ? confirmBotPick(slot.player?.id || slot.player?.summonerName, slot.champion?.phaseIndex) : startEditingPick(slot.player?.id || slot.player?.summonerName, slot.champion?.phaseIndex)">
                    {{ isPlayerBot(slot.player) ? 'ü§ñ Confirmar Bot' : '‚úèÔ∏è Editar' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- A√ß√µes -->
      <div class="confirmation-actions">
        <button class="btn btn-danger btn-lg" (click)="cancelPickBan()">
          ‚ùå Cancelar Partida
        </button>
        <button class="btn btn-secondary btn-lg" (click)="cancelFinalDraft()">
          ‚úèÔ∏è Editar Sele√ß√£o
        </button>
        <button class="btn btn-success btn-lg" (click)="confirmFinalDraft()">
          ‚úÖ Confirmar e Continuar
        </button>
      </div>
    </div>
  </div>
</div>
