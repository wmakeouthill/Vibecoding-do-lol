<div class="game-in-progress-container">
  <!-- Header -->
  <div class="game-header">
    <div class="game-title">
      <h2>{{ getGameStatusIcon() }} Partida em Andamento</h2>
      <p class="game-status">{{ getGameStatusText() }}</p>
    </div>

    <div class="game-info">
      <div class="game-timer">
        <span class="timer-label">Dura√ß√£o:</span>
        <span class="timer-value">{{ getGameDurationFormatted() }}</span>
      </div>

      <div class="lcu-status" *ngIf="lcuDetectionEnabled">
        <span class="status-indicator" [class.active]="lcuGameDetected"></span>
        <span>{{ lcuGameDetected ? 'LCU Conectado' : 'Aguardando LCU' }}</span>
      </div>
    </div>
  </div>

  <!-- Teams Display -->
  <div class="teams-section">
    <div class="team team-blue" [style.border-color]="getTeamColor('blue')">
      <div class="team-header">
        <h3 [style.color]="getTeamColor('blue')">{{ getTeamName('blue') }}</h3>
        <div class="team-status" *ngIf="selectedWinner">
          <span class="winner-badge" *ngIf="selectedWinner === 'blue'">üèÜ VIT√ìRIA</span>
          <span class="loser-badge" *ngIf="selectedWinner === 'red'">üíÄ DERROTA</span>
        </div>
      </div>

      <div class="team-players">
        <div class="player" *ngFor="let player of getTeamPlayers('blue')"
             [class.current-player]="currentPlayer && player.id === currentPlayer.id">
          <div class="player-info">
            <span class="player-name">{{ player.summonerName || player.name }}</span>
            <span class="player-role" *ngIf="player.role">{{ player.role }}</span>
          </div>
          <div class="player-champion" *ngIf="player.champion">
            <span class="champion-name">{{ player.champion.name }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="vs-divider">
      <span class="vs-text">VS</span>
      <div class="game-duration-display">
        {{ getGameDurationFormatted() }}
      </div>
    </div>

    <div class="team team-red" [style.border-color]="getTeamColor('red')">
      <div class="team-header">
        <h3 [style.color]="getTeamColor('red')">{{ getTeamName('red') }}</h3>
        <div class="team-status" *ngIf="selectedWinner">
          <span class="winner-badge" *ngIf="selectedWinner === 'red'">üèÜ VIT√ìRIA</span>
          <span class="loser-badge" *ngIf="selectedWinner === 'blue'">üíÄ DERROTA</span>
        </div>
      </div>

      <div class="team-players">
        <div class="player" *ngFor="let player of getTeamPlayers('red')"
             [class.current-player]="currentPlayer && player.id === currentPlayer.id">
          <div class="player-info">
            <span class="player-name">{{ player.summonerName || player.name }}</span>
            <span class="player-role" *ngIf="player.role">{{ player.role }}</span>
          </div>
          <div class="player-champion" *ngIf="player.champion">
            <span class="champion-name">{{ player.champion.name }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Status Information -->
  <div class="game-status-section">
    <div class="status-card">
      <div class="status-item">
        <span class="status-label">Status:</span>
        <span class="status-value" [class]="gameStatus">{{ getGameStatusText() }}</span>
      </div>

      <div class="status-item" *ngIf="gameStartTime">
        <span class="status-label">In√≠cio:</span>
        <span class="status-value">{{ gameStartTime | date:'HH:mm:ss' }}</span>
      </div>

      <div class="status-item" *ngIf="lcuGameDetected">
        <span class="status-label">Detec√ß√£o LCU:</span>
        <span class="status-value connected">‚úÖ Ativa</span>
      </div>
    </div>
  </div>

  <!-- Winner Declaration Section -->
  <div class="winner-section" *ngIf="gameStatus === 'ended' || !lcuDetectionEnabled">
    <div class="winner-declaration">
      <h3>Declarar Vencedor</h3>
      <p>Selecione o time vencedor da partida:</p>

      <div class="winner-buttons">
        <button class="team-button team-blue-btn"
                [class.selected]="selectedWinner === 'blue'"
                (click)="declareWinner('blue')">
          <span class="team-icon">üõ°Ô∏è</span>
          <span class="team-name">Time Azul</span>
          <span class="winner-icon" *ngIf="selectedWinner === 'blue'">‚úì</span>
        </button>

        <button class="team-button team-red-btn"
                [class.selected]="selectedWinner === 'red'"
                (click)="declareWinner('red')">
          <span class="team-icon">‚öîÔ∏è</span>
          <span class="team-name">Time Vermelho</span>
          <span class="winner-icon" *ngIf="selectedWinner === 'red'">‚úì</span>
        </button>
      </div>

      <div class="your-team-info" *ngIf="getMyTeam()">
        <p>Seu time: <strong [style.color]="getTeamColor(getMyTeam()!)">{{ getTeamName(getMyTeam()!) }}</strong></p>
        <p class="result-preview" *ngIf="selectedWinner">
          Resultado:
          <span [class.victory]="isMyTeamWinner()" [class.defeat]="!isMyTeamWinner()">
            {{ isMyTeamWinner() ? 'üèÜ VIT√ìRIA' : 'üíÄ DERROTA' }}
          </span>
        </p>
      </div>
    </div>
  </div>

  <!-- Settings Section -->
  <div class="settings-section">
    <div class="settings-card">
      <h4>Configura√ß√µes</h4>      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox"
                 [(ngModel)]="lcuDetectionEnabled"
                 (change)="toggleLCUDetection()">
          <span class="checkmark"></span>
          Detec√ß√£o autom√°tica via LCU
        </label>
        <p class="setting-description">
          Detectar automaticamente o fim da partida atrav√©s do cliente do League of Legends
        </p>
      </div>      <div class="setting-item">
        <div class="detection-buttons">
          <button class="btn btn-outline retry-detection-btn" (click)="retryAutoDetection()">
            <span class="btn-icon">üîÑ</span>
            Tentar Detectar Vencedor
          </button>

          <button class="btn btn-outline simulate-last-match-btn" (click)="simulateLastMatch()">
            <span class="btn-icon">üé≠</span>
            Detectar √öltima Partida
          </button>
        </div>
        <p class="setting-description">
          Tenta detectar o vencedor automaticamente via LCU ou comparando com o hist√≥rico. Use "Detectar √öltima Partida" para simular um jogo igual √† sua √∫ltima partida.
        </p>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="btn btn-primary"
            [disabled]="!selectedWinner"
            (click)="confirmWinner()"
            *ngIf="gameStatus === 'ended' || !lcuDetectionEnabled">
      <span class="btn-icon">‚úÖ</span>
      Confirmar Resultado
    </button>

    <button class="btn btn-secondary" (click)="cancelGame()">
      <span class="btn-icon">‚ùå</span>
      Cancelar Partida
    </button>
  </div>

  <!-- Debug Info (only in development) -->
  <div class="debug-section" *ngIf="false">
    <h4>Debug Info</h4>
    <pre>{{ {
      gameStatus: gameStatus,
      lcuDetected: lcuGameDetected,
      selectedWinner: selectedWinner,
      gameDuration: gameDuration,
      lcuEnabled: lcuDetectionEnabled
    } | json }}</pre>
  </div>

  <!-- Match Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showMatchConfirmation" (click)="closeMatchConfirmation()">
    <div class="match-confirmation-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>üîç Partida Detectada no League of Legends</h3>
        <button class="close-btn" (click)="closeMatchConfirmation()">√ó</button>
      </div>

      <div class="modal-content" *ngIf="detectedLCUMatch && matchComparisonResult">
        <!-- Match Information -->
        <div class="match-info-section">
          <div class="confidence-indicator">
            <div class="confidence-badge" [class.high-confidence]="matchComparisonResult.confidence >= 80"
                 [class.medium-confidence]="matchComparisonResult.confidence >= 50 && matchComparisonResult.confidence < 80"
                 [class.low-confidence]="matchComparisonResult.confidence < 50">
              {{ matchComparisonResult.confidence }}% de similaridade
            </div>
            <p class="confidence-reason">{{ matchComparisonResult.reason }}</p>
          </div>

          <div class="lcu-match-details">
            <h4>Detalhes da Partida do LoL:</h4>
            <div class="match-detail-row">
              <span class="label">Data/Hora:</span>
              <span class="value">{{ formatLCUMatchDate(detectedLCUMatch.gameCreation) }}</span>
            </div>
            <div class="match-detail-row">
              <span class="label">Dura√ß√£o:</span>
              <span class="value">{{ formatGameDuration(detectedLCUMatch.gameDuration) }}</span>
            </div>
            <div class="match-detail-row">
              <span class="label">ID da Partida:</span>
              <span class="value">{{ detectedLCUMatch.gameId }}</span>
            </div>
            <div class="match-detail-row" *ngIf="getLCUMatchWinner(detectedLCUMatch)">
              <span class="label">Vencedor:</span>
              <span class="value winner" [style.color]="getLCUMatchWinner(detectedLCUMatch) === 'blue' ? '#4FC3F7' : '#F44336'">
                Time {{ getLCUMatchWinner(detectedLCUMatch) === 'blue' ? 'Azul' : 'Vermelho' }} üèÜ
              </span>
            </div>
          </div>
        </div>

        <!-- Team Comparison -->
        <div class="team-comparison-section">
          <h4>Compara√ß√£o de Times:</h4>

          <div class="teams-comparison">
            <!-- Current Game Teams -->
            <div class="current-game-teams">
              <h5>Jogo Atual no App:</h5>
              <div class="team-comparison-row">
                <div class="team-comp team-blue">
                  <strong>Time Azul:</strong>
                  <ul class="champion-list">
                    <li *ngFor="let player of getTeamPlayers('blue')">
                      {{ player.champion?.name || 'Sem campe√£o' }}
                    </li>
                  </ul>
                </div>
                <div class="team-comp team-red">
                  <strong>Time Vermelho:</strong>
                  <ul class="champion-list">
                    <li *ngFor="let player of getTeamPlayers('red')">
                      {{ player.champion?.name || 'Sem campe√£o' }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- LCU Match Teams -->
            <div class="lcu-game-teams">
              <h5>Partida Detectada do LoL:</h5>
              <div class="team-comparison-row">
                <div class="team-comp team-blue">
                  <strong>Time {{ detectedLCUMatch.teams?.[0]?.teamId === 100 ? 'Azul' : 'Vermelho' }}:</strong>
                  <ul class="champion-list">
                    <li *ngFor="let participant of getLCUTeamParticipants(detectedLCUMatch, 100)">
                      {{ getChampionNameById(participant.championId) || 'Champion ' + participant.championId }}
                    </li>
                  </ul>
                </div>
                <div class="team-comp team-red">
                  <strong>Time {{ detectedLCUMatch.teams?.[1]?.teamId === 200 ? 'Vermelho' : 'Azul' }}:</strong>
                  <ul class="champion-list">
                    <li *ngFor="let participant of getLCUTeamParticipants(detectedLCUMatch, 200)">
                      {{ getChampionNameById(participant.championId) || 'Champion ' + participant.championId }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Confirmation Message -->
        <div class="confirmation-message">
          <p class="confirmation-text">
            <strong>Esta √© a partida que voc√™ acabou de jogar?</strong>
          </p>
          <p class="confirmation-subtitle">
            Se confirmar, o resultado desta partida ser√° aplicado ao seu jogo no aplicativo.
          </p>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-primary" (click)="confirmDetectedMatch()"
                [disabled]="!getLCUMatchWinner(detectedLCUMatch)">
          <span class="btn-icon">‚úÖ</span>
          Sim, Esta √© a Partida
        </button>
        <button class="btn btn-secondary" (click)="rejectDetectedMatch()">
          <span class="btn-icon">‚ùå</span>
          N√£o, Buscar Outra
        </button>
        <button class="btn btn-outline" (click)="closeMatchConfirmation()">
          <span class="btn-icon">üö´</span>
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>
