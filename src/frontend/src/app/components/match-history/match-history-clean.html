<div class="match-history">
  <!-- Header -->
  <div class="history-header">
    <h2>📊 Histórico de Partidas</h2>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
      <div class="tabs-nav">
        <button
          class="tab-btn"
          [class.active]="isRiotTab()"
          (click)="setActiveTab('riot')">
          🏆 Riot API
        </button>
        <button
          class="tab-btn"
          [class.active]="isCustomTab()"
          (click)="setActiveTab('custom')">
          🎮 Partidas Customizadas
        </button>
      </div>

      <div class="history-stats" *ngIf="getCurrentMatches().length > 0">
        <div class="stat-summary">
          <span class="total-matches">{{ getCurrentMatches().length }} partidas</span>
          <span class="win-rate">{{ getWinRate() }}% de vitória</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Carregando histórico...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && error" class="error-container">
    <div class="error-icon">⚠️</div>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadCurrentTabMatches()">Tentar Novamente</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && getCurrentMatches().length === 0" class="empty-container">
    <div class="empty-icon">{{ isRiotTab() ? '🏆' : '🎮' }}</div>
    <h3>{{ isRiotTab() ? 'Nenhuma partida ranqueada encontrada' : 'Nenhuma partida customizada encontrada' }}</h3>
    <p>{{ isRiotTab() ? 'Você ainda não jogou nenhuma partida ranqueada.' : 'Ainda não há partidas customizadas registradas.' }}</p>
    <button class="btn btn-primary" (click)="loadCurrentTabMatches()">Recarregar</button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content" *ngIf="!loading && !error && getCurrentMatches().length > 0">

    <!-- Riot API Tab Content -->
    <div *ngIf="isRiotTab()" class="riot-matches-content">
      <div class="match-list riot-style">
        <div *ngFor="let match of riotMatches; trackBy: trackMatch"
             class="match-item riot-match"
             [class.win]="match.playerStats?.isWin"
             [class.loss]="!match.playerStats?.isWin">
          <div class="match-result">
            <div class="result-indicator">
              <span class="result-text">{{ match.playerStats?.isWin ? 'V' : 'D' }}</span>
            </div>
            <div class="match-type">{{ getGameModeDisplay(match.gameMode) }}</div>
            <div class="match-duration">{{ getMatchDuration(match) }}</div>
          </div>

          <div class="champion-info">
            <div class="champion-name">{{ match.playerStats?.champion }}</div>
            <div class="kda">{{ getKDA(match) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Matches Tab Content -->
    <div *ngIf="isCustomTab()" class="custom-matches-content">
      <!-- Debug info -->
      <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border: 1px solid #ccc;">
        <strong>🔍 DEBUG INFO:</strong><br>
        activeTab: {{ activeTab }}<br>
        isCustomTab(): {{ isCustomTab() }}<br>
        customMatches.length: {{ customMatches.length }}<br>
        getCurrentMatches().length: {{ getCurrentMatches().length }}<br>
        getSimpleMatchCount(): {{ getSimpleMatchCount() }}<br>
        <button (click)="debugCustomMatches()">Log Debug Info</button>
      </div>

      <!-- Summary Stats for Custom Matches -->
      <div class="summary-stats custom-theme">
        <div class="summary-card">
          <div class="summary-value">{{ getCustomStats().totalWins }}/{{ getCurrentMatches().length }}</div>
          <div class="summary-label">Vitórias Customizadas</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">{{ getCustomWinStreakInfo().current }}</div>
          <div class="summary-label">Sequência Atual</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">{{ getCustomWinStreakInfo().longest }}</div>
          <div class="summary-label">Maior Sequência</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" [class.positive]="getCustomStats().totalMMRGained > 0">
            {{ getCustomStats().totalMMRGained > 0 ? '+' : '' }}{{ getCustomStats().totalMMRGained }}
          </div>
          <div class="summary-label">MMR Total</div>
        </div>
      </div>

      <!-- Custom Match List -->
      <div class="match-list custom-style">
        <!-- Debug: Teste simples de renderização -->
        <div style="background: yellow; padding: 10px; margin: 10px 0;">
          <strong>🚨 TESTE DE RENDERIZAÇÃO:</strong><br>
          Total de partidas: {{ getCurrentMatches().length }}<br>
          Primeira partida ID: {{ getCurrentMatches()[0]?.id || 'Nenhuma partida' }}<br>
          Primeira partida campeão: {{ getCurrentMatches()[0]?.playerStats?.champion || 'Sem campeão' }}
        </div>

        <!-- Lista simples sem estrutura complexa -->
        <div *ngFor="let match of getCurrentMatches(); let i = index; trackBy: trackMatch"
             style="background: lightblue; padding: 5px; margin: 5px 0; border: 1px solid blue;">
          <strong>Partida {{ i + 1 }}:</strong> {{ match.playerStats?.champion }} - {{ match.playerStats?.isWin ? 'VITÓRIA' : 'DERROTA' }}
        </div>
      </div>

      <!-- Load More Button -->
      <div class="load-more-container" *ngIf="hasMoreMatches()">
        <button class="btn btn-secondary load-more-btn"
                (click)="loadMoreMatches()"
                [disabled]="loading">
          {{ loading ? 'Carregando...' : 'Carregar Mais' }}
        </button>
      </div>
    </div>
  </div>
</div>
